<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Trackers</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }

           body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
             background: url('bg2.jpg');
            color:#2c3e50;
        }

        .container{
            max-width: 800px;
            display: block;
            margin:auto;
                  padding: 20px;

        }

        h1 { margin-bottom: 8px; }
        .subtitle { color: #666; font-size: 14px; margin-bottom: 24px; }

        /* â”€â”€ top actions â”€â”€ */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-primary { background: #2196F3; color: white; }
        .btn-success { background: #4CAF50; color: white; }
        .btn-danger  { background: #f44336; color: white; }
        .btn:hover { opacity: 0.9; }

        /* â”€â”€ tracker list â”€â”€ */
        .tracker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .tracker-card {
            background: white;
            border-radius: 8px;
            padding: 18px;
            border: 2px solid #e0e0e0;
            position: relative;
        }

        .tracker-card:hover { border-color: #2196F3; }

        .tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .tracker-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .type-badge {
            font-size: 11px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 4px;
            background: #e8e8e8;
            color: #555;
        }

        .tracker-details {
            margin: 12px 0;
            min-height: 40px;
        }

        .option-pill {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
            font-weight: 600;
            margin-right: 6px;
            margin-bottom: 6px;
        }

        .tracker-meta {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
        }

        .tracker-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .btn-small {
            padding: 6px 14px;
            font-size: 13px;
        }

        /* â”€â”€ empty state â”€â”€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state .icon { font-size: 48px; margin-bottom: 12px; }

        /* â”€â”€ modal â”€â”€ */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal.show { display: flex; }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-title {
            font-size: 1.3em;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            line-height: 1;
            padding: 0;
            width: 32px;
            height: 32px;
        }

        .close-btn:hover { color: #333; }

        /* â”€â”€ form â”€â”€ */
        .form-group {
            margin-bottom: 18px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            font-size: 14px;
            color: #444;
            margin-bottom: 6px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        textarea.form-input {
            min-height: 60px;
            resize: vertical;
        }

        .options-section {
            background: #f8f9fa;
            padding: 14px;
            border-radius: 4px;
            margin-top: 12px;
        }

        .options-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .options-header h4 {
            font-size: 14px;
            font-weight: 600;
            margin: 0;
        }

        .option-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            background: white;
            padding: 8px;
            border-radius: 4px;
        }

        .option-row input[type="text"] {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .option-row input[type="color"] {
            width: 50px;
            height: 36px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .remove-option-btn {
            background: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-weight: 600;
        }

        .remove-option-btn:hover { background: #d32f2f; }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid #f0f0f0;
        }

        .hidden { display: none !important; }

        /* â”€â”€ starter templates â”€â”€ */
        .templates-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .template-btn {
            padding: 12px;
            background: #f0f4f8;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            text-align: left;
            color: #333;
        }

        .template-btn:hover {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .template-type {
            font-size: 11px;
            color: #888;
            font-weight: 400;
            margin-top: 4px;
        }



        .bottom-navigation{
        position: sticky;
        bottom: 0;
        padding-top: 15px;     
        text-align: center;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        background: #FFF;
        box-shadow: rgba(0, 0, 0, 0.05) 0px 6px 24px 0px, rgba(0, 0, 0, 0.08) 0px 0px 0px 1px;
    }
    .bottom-navigation a{
        text-decoration: none;
        color: #333;
    }
    </style>
</head>
<body>

<h1>Manage Trackers</h1>
<p class="subtitle">Add, edit, or remove trackers. Changes update My Day instantly.</p>

<div class="container">
    <!-- starter templates -->
<div class="templates-section">
    <div class="section-title">Quick Start Templates</div>
    <div class="templates-grid" id="templatesGrid"></div>
</div>

<!-- top bar -->
<div class="top-bar">
    <h2 style="margin:0; font-size:1.1em;">My Trackers</h2>
    <button class="btn btn-primary" onclick="openAddModal()">+ Add New Tracker</button>
</div>

<!-- tracker list -->
<div class="tracker-grid" id="trackerList"></div>

<!-- add/edit modal -->
<div class="modal" id="trackerModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">Add Tracker</h3>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>

        <form id="trackerForm" onsubmit="saveTracker(event)">
            <div class="form-group">
                <label class="form-label">Tracker Name</label>
                <input type="text" id="trackerName" class="form-input" placeholder="e.g., Daily Mood" required>
            </div>

            <div class="form-group">
                <label class="form-label">Tracker Type</label>
                <select id="trackerType" class="form-select" onchange="handleTypeChange()" required>
                    <option value="dropdown">Dropdown (Select from options)</option>
                    <option value="yesno">Yes / No</option>
                    <option value="numeric">Numeric (Enter number)</option>
                    <option value="text">Text Field (Write notes)</option>
                </select>
            </div>

            <!-- dropdown options -->
            <div id="dropdownSection" class="options-section">
                <div class="options-header">
                    <h4>Options</h4>
                    <button type="button" class="btn btn-success btn-small" onclick="addOption()">+ Add Option</button>
                </div>
                <div id="optionsList"></div>
            </div>

            <!-- numeric settings -->
            <div id="numericSection" class="options-section hidden">
                <h4 style="margin-bottom:12px;">Numeric Settings</h4>
                <div class="form-group">
                    <label class="form-label">Prefix (optional)</label>
                    <input type="text" id="numericPrefix" class="form-input" placeholder="e.g., $, #" maxlength="10">
                </div>
                <div class="form-group">
                    <label class="form-label">Suffix (optional)</label>
                    <input type="text" id="numericSuffix" class="form-input" placeholder="e.g., lbs, kg, hours" maxlength="20">
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Tracker</button>
            </div>
        </form>
    </div>
</div>

</div>


  <div class="bottom-navigation">
            <div><a href="template.html"><img src="tracker_small.png"/><br/>Tracker</a></div>
            <div><a href="report.html"><img src="calendar_small.png"/><br/>Report</a></div>
            <div><a href="index.html"><img src="today_small.png"/><br/>My Day</a></div>
            <div><a href="backup.html"><img src="backup.png"/><br/>Backup</a></div>
        </div>



<script>
/* â•â•â• DB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let db;
const DB_NAME    = 'TrackerDB';
const STORE_NAME = 'trackers';
let editingId = null;

function initDB() {
    const req = indexedDB.open(DB_NAME, 2);
    req.onerror   = () => console.error('DB failed');
    req.onsuccess = () => { db = req.result; loadTrackers(); loadTemplates(); };
    req.onupgradeneeded = (e) => {
        const d = e.target.result;
        if (d.objectStoreNames.contains(STORE_NAME)) {
            d.deleteObjectStore(STORE_NAME);
        }
        const s = d.createObjectStore(STORE_NAME, { keyPath:'id', autoIncrement:true });
        s.createIndex('title','title');
        s.createIndex('type','type');
    };
}

function getAllTrackers() {
    return new Promise((res, rej) => {
        const req = db.transaction([STORE_NAME],'readonly').objectStore(STORE_NAME).getAll();
        req.onsuccess = () => res(req.result);
        req.onerror   = () => rej(req.error);
    });
}

function addTracker(tracker) {
    return new Promise((res, rej) => {
        const req = db.transaction([STORE_NAME],'readwrite').objectStore(STORE_NAME).add(tracker);
        req.onsuccess = () => res(req.result);
        req.onerror   = () => rej(req.error);
    });
}

function updateTracker(id, tracker) {
    return new Promise((res, rej) => {
        const req = db.transaction([STORE_NAME],'readwrite').objectStore(STORE_NAME).put({...tracker, id});
        req.onsuccess = () => res();
        req.onerror   = () => rej(req.error);
    });
}

function deleteTracker(id) {
    return new Promise((res, rej) => {
        const req = db.transaction([STORE_NAME],'readwrite').objectStore(STORE_NAME).delete(id);
        req.onsuccess = () => res();
        req.onerror   = () => rej(req.error);
    });
}

/* â•â•â• STARTER TEMPLATES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TEMPLATES = [
    { title: 'Daily Mood', type: 'dropdown', options: [
        {title:'Very Happy', color:'#4CAF50'}, {title:'Happy', color:'#8BC34A'}, 
        {title:'Neutral', color:'#FFC107'}, {title:'Sad', color:'#FF9800'}, {title:'Very Sad', color:'#F44336'}
    ]},
    { title: 'Sleep Quality', type: 'dropdown', options: [
        {title:'Excellent', color:'#4CAF50'}, {title:'Good', color:'#8BC34A'},
        {title:'Fair', color:'#FFC107'}, {title:'Poor', color:'#FF9800'}, {title:'Terrible', color:'#F44336'}
    ]},
    { title: 'Exercise', type: 'dropdown', options: [
        {title:'Intense Workout', color:'#E91E63'}, {title:'Moderate Exercise', color:'#9C27B0'},
        {title:'Light Activity', color:'#673AB7'}, {title:'Stretching', color:'#3F51B5'}, {title:'No Exercise', color:'#9E9E9E'}
    ]},
    { title: 'Meditation', type: 'yesno' },
    { title: 'Weight', type: 'numeric', numericPrefix: '', numericSuffix: 'lbs' },
    { title: 'Water Intake', type: 'numeric', numericPrefix: '', numericSuffix: 'glasses' },
    { title: 'Daily Journal', type: 'text' },
    { title: 'Gratitude', type: 'text' }
];

function loadTemplates() {
    const grid = document.getElementById('templatesGrid');
    grid.innerHTML = TEMPLATES.map(t => `
        <button class="template-btn" onclick='useTemplate(${JSON.stringify(t)})'>
            ${t.title}
            <div class="template-type">${typeLabel(t.type)}</div>
        </button>
    `).join('');
}

async function useTemplate(template) {
    const tracker = {
        title: template.title,
        type: template.type,
        createdAt: new Date().toISOString()
    };
    if (template.options) tracker.options = template.options;
    if (template.numericPrefix !== undefined) tracker.numericPrefix = template.numericPrefix;
    if (template.numericSuffix !== undefined) tracker.numericSuffix = template.numericSuffix;

    await addTracker(tracker);
    loadTrackers();
}

/* â•â•â• LOAD TRACKERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadTrackers() {
    const trackers = await getAllTrackers();
    const list = document.getElementById('trackerList');

    if (!trackers.length) {
        list.innerHTML = `<div class="empty-state">
            <div class="icon">ğŸ“Š</div>
            <p>No trackers yet. Use a template above or add your own!</p>
        </div>`;
        return;
    }

    list.innerHTML = trackers.map(t => {
        const type = t.type || 'dropdown';
        let detailHTML = '';

        if (type === 'dropdown' && t.options) {
            detailHTML = t.options.map(o => 
                `<span class="option-pill" style="background:${o.color}">${o.title}</span>`
            ).join('');
        } else if (type === 'yesno') {
            detailHTML = '<span style="color:#666;font-size:13px;">Yes or No</span>';
        } else if (type === 'numeric') {
            const p = t.numericPrefix || '';
            const s = t.numericSuffix || '';
            detailHTML = `<span style="color:#666;font-size:13px;">Format: ${p}[number]${s ? ' '+s : ''}</span>`;
        } else {
            detailHTML = '<span style="color:#666;font-size:13px;">Free text entry</span>';
        }

        return `
            <div class="tracker-card">
                <div class="tracker-header">
                    <div class="tracker-title">${t.title}</div>
                    <div class="type-badge">${typeLabel(type)}</div>
                </div>
                <div class="tracker-details">${detailHTML}</div>
                <div class="tracker-meta">Created: ${new Date(t.createdAt).toLocaleDateString()}</div>
                <div class="tracker-actions">
                    <button class="btn btn-primary btn-small" onclick="openEditModal(${t.id})">Edit</button>
                    <button class="btn btn-danger btn-small" onclick="confirmDelete(${t.id}, '${t.title.replace(/'/g, "\\'")}')">Delete</button>
                </div>
            </div>`;
    }).join('');
}

/* â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openAddModal() {
    editingId = null;
    document.getElementById('modalTitle').textContent = 'Add New Tracker';
    document.getElementById('trackerForm').reset();
    document.getElementById('trackerType').value = 'dropdown';
    document.getElementById('optionsList').innerHTML = '';
    handleTypeChange();
    addOption(); // default one option
    document.getElementById('trackerModal').classList.add('show');
}

async function openEditModal(id) {
    editingId = id;
    const trackers = await getAllTrackers();
    const tracker = trackers.find(t => t.id === id);
    if (!tracker) return;

    document.getElementById('modalTitle').textContent = 'Edit Tracker';
    document.getElementById('trackerName').value = tracker.title;
    document.getElementById('trackerType').value = tracker.type || 'dropdown';

    if (tracker.type === 'numeric') {
        document.getElementById('numericPrefix').value = tracker.numericPrefix || '';
        document.getElementById('numericSuffix').value = tracker.numericSuffix || '';
    }

    handleTypeChange();

    if ((tracker.type === 'dropdown' || !tracker.type) && tracker.options) {
        document.getElementById('optionsList').innerHTML = '';
        tracker.options.forEach(o => addOption(o.title, o.color));
    }

    document.getElementById('trackerModal').classList.add('show');
}

function closeModal() {
    document.getElementById('trackerModal').classList.remove('show');
    editingId = null;
}

function handleTypeChange() {
    const type = document.getElementById('trackerType').value;
    document.getElementById('dropdownSection').classList.toggle('hidden', type !== 'dropdown');
    document.getElementById('numericSection').classList.toggle('hidden', type !== 'numeric');
}

/* â•â•â• OPTIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addOption(title = '', color = '#4CAF50') {
    const list = document.getElementById('optionsList');
    const id = Date.now() + Math.random();
    const div = document.createElement('div');
    div.className = 'option-row';
    div.id = `option-${id}`;
    div.innerHTML = `
        <input type="text" class="option-title" placeholder="Option name" value="${title}">
        <input type="color" class="option-color" value="${color}">
        <button type="button" class="remove-option-btn" onclick="removeOption('${id}')">Ã—</button>
    `;
    list.appendChild(div);
}

function removeOption(id) {
    document.getElementById(`option-${id}`)?.remove();
}

/* â•â•â• SAVE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function saveTracker(e) {
    e.preventDefault();

    const title = document.getElementById('trackerName').value.trim();
    const type  = document.getElementById('trackerType').value;

    if (!title) return alert('Please enter a tracker name');

    const tracker = { title, type, createdAt: new Date().toISOString() };

    if (type === 'dropdown') {
        const rows = [...document.querySelectorAll('#optionsList .option-row')];
        if (!rows.length) return alert('Add at least one option');

        const options = rows.map(row => ({
            title: row.querySelector('.option-title').value.trim(),
            color: row.querySelector('.option-color').value
        }));

        if (options.some(o => !o.title)) return alert('Fill in all option names');
        tracker.options = options;

    } else if (type === 'numeric') {
        tracker.numericPrefix = document.getElementById('numericPrefix').value.trim();
        tracker.numericSuffix = document.getElementById('numericSuffix').value.trim();
    }

    if (editingId) {
        await updateTracker(editingId, tracker);
    } else {
        await addTracker(tracker);
    }

    closeModal();
    loadTrackers();
}

/* â•â•â• DELETE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function confirmDelete(id, title) {
    if (!confirm(`Delete "${title}"?\n\nThis will remove the tracker but keep your saved data.`)) return;
    await deleteTracker(id);
    loadTrackers();
}

/* â•â•â• UTILS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function typeLabel(t) {
    return {dropdown:'Dropdown', yesno:'Yes/No', numeric:'Numeric', text:'Text'}[t] || 'Dropdown';
}

/* â•â•â• BOOT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
initDB();
</script>
</body>
</html>