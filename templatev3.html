<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker Templates</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            margin-bottom: 30px;
        }

        .section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .template-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
        }

        .template-card.built-in {
            border-color: #2196F3;
            background: #e3f2fd;
        }

        .template-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .template-description {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
        }

        .template-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 15px;
        }

        .option-tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
        }

        .template-actions {
            display: flex;
            gap: 8px;
        }

        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            background: #2196F3;
            color: white;
            margin-left: 10px;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        textarea.form-input {
            min-height: 80px;
            resize: vertical;
        }

        .hidden {
            display: none;
        }

        .options-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .options-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .option-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            align-items: center;
        }

        .option-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .color-picker {
            width: 50px;
            height: 35px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .remove-option-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“‹ Tracker Templates</h1>

        <!-- Built-in Templates Section -->
        <div class="section">
            <div class="section-header">
                <h2>Built-in Templates <span class="badge">Popular</span></h2>
            </div>
            <div class="template-grid" id="builtInTemplates"></div>
        </div>

        <!-- Custom Templates Section -->
        <div class="section">
            <div class="section-header">
                <h2>My Custom Templates</h2>
                <button class="btn btn-primary" onclick="openCreateTemplateModal()">+ Create Template</button>
            </div>
            <div class="template-grid" id="customTemplates"></div>
        </div>
    </div>

    <!-- Create/Edit Template Modal -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Create Template</h2>
                <button class="close-btn" onclick="closeTemplateModal()">&times;</button>
            </div>

            <form id="templateForm" onsubmit="saveTemplate(event)">
                <div class="form-group">
                    <label class="form-label" for="templateTitle">Template Title</label>
                    <input 
                        type="text" 
                        id="templateTitle" 
                        class="form-input" 
                        placeholder="e.g., Mood Tracker, Water Intake"
                        required
                    >
                </div>

                <div class="form-group">
                    <label class="form-label" for="templateDescription">Description (Optional)</label>
                    <textarea 
                        id="templateDescription" 
                        class="form-input" 
                        placeholder="What is this template for?"
                    ></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="templateType">Tracker Type</label>
                    <select id="templateType" class="form-select" onchange="handleTemplateTypeChange()" required>
                        <option value="dropdown">Dropdown (Select from options)</option>
                        <option value="yesno">Yes/No</option>
                        <option value="numeric">Numeric (Enter number)</option>
                        <option value="text">Text Field (Write notes)</option>
                    </select>
                </div>

                <div id="templateDropdownOptions" class="options-section">
                    <div class="options-header">
                        <h3 style="margin: 0;">Options</h3>
                        <button type="button" class="btn btn-small btn-primary" onclick="addTemplateOption()">+ Add Option</button>
                    </div>
                    <div id="templateOptionsList"></div>
                </div>

                <div id="templateNumericSettings" class="options-section hidden">
                    <h3 style="margin-bottom: 15px;">Numeric Settings</h3>
                    <div class="form-group">
                        <label class="form-label" for="templateNumericPrefix">Prefix (Optional)</label>
                        <input 
                            type="text" 
                            id="templateNumericPrefix" 
                            class="form-input" 
                            placeholder="e.g., $, #"
                            maxlength="10"
                        >
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="templateNumericSuffix">Suffix (Optional)</label>
                        <input 
                            type="text" 
                            id="templateNumericSuffix" 
                            class="form-input" 
                            placeholder="e.g., lbs, kg, hours, steps"
                            maxlength="20"
                        >
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn" onclick="closeTemplateModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Template</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // IndexedDB Setup for Trackers
        let db;
        const DB_NAME = 'TrackerDB';
        const STORE_NAME = 'trackers';
        let currentTemplateId = null;

        // Built-in templates
        const BUILT_IN_TEMPLATES = [
            {
                id: 'mood',
                title: 'Daily Mood Tracker',
                description: 'Track your emotional state throughout the day',
                type: 'dropdown',
                options: [
                    { title: 'Very Happy', color: '#4CAF50' },
                    { title: 'Happy', color: '#8BC34A' },
                    { title: 'Neutral', color: '#FFC107' },
                    { title: 'Sad', color: '#FF9800' },
                    { title: 'Very Sad', color: '#F44336' }
                ]
            },
            {
                id: 'water',
                title: 'Water Intake Tracker',
                description: 'Monitor your daily water consumption',
                type: 'dropdown',
                options: [
                    { title: '1-2 Glasses', color: '#81D4FA' },
                    { title: '3-4 Glasses', color: '#4FC3F7' },
                    { title: '5-6 Glasses', color: '#29B6F6' },
                    { title: '7-8 Glasses', color: '#03A9F4' },
                    { title: '9+ Glasses', color: '#0288D1' }
                ]
            },
            {
                id: 'sleep',
                title: 'Sleep Quality Tracker',
                description: 'Rate how well you slept',
                type: 'dropdown',
                options: [
                    { title: 'Excellent', color: '#4CAF50' },
                    { title: 'Good', color: '#8BC34A' },
                    { title: 'Fair', color: '#FFC107' },
                    { title: 'Poor', color: '#FF9800' },
                    { title: 'Terrible', color: '#F44336' }
                ]
            },
            {
                id: 'exercise',
                title: 'Exercise Tracker',
                description: 'Track your daily physical activity',
                type: 'dropdown',
                options: [
                    { title: 'Intense Workout', color: '#E91E63' },
                    { title: 'Moderate Exercise', color: '#9C27B0' },
                    { title: 'Light Activity', color: '#673AB7' },
                    { title: 'Stretching Only', color: '#3F51B5' },
                    { title: 'No Exercise', color: '#9E9E9E' }
                ]
            },
            {
                id: 'productivity',
                title: 'Productivity Level',
                description: 'Rate your daily productivity',
                type: 'dropdown',
                options: [
                    { title: 'Very Productive', color: '#4CAF50' },
                    { title: 'Productive', color: '#8BC34A' },
                    { title: 'Average', color: '#FFC107' },
                    { title: 'Below Average', color: '#FF9800' },
                    { title: 'Unproductive', color: '#F44336' }
                ]
            },
            {
                id: 'energy',
                title: 'Energy Level',
                description: 'Track your energy throughout the day',
                type: 'dropdown',
                options: [
                    { title: 'Very High', color: '#FF5722' },
                    { title: 'High', color: '#FF9800' },
                    { title: 'Medium', color: '#FFC107' },
                    { title: 'Low', color: '#9E9E9E' },
                    { title: 'Exhausted', color: '#607D8B' }
                ]
            },
            {
                id: 'meditation',
                title: 'Daily Meditation',
                description: 'Did you meditate today?',
                type: 'yesno'
            },
            {
                id: 'weight',
                title: 'Weight Tracker',
                description: 'Track your weight over time',
                type: 'numeric',
                numericPrefix: '',
                numericSuffix: 'lbs'
            },
            {
                id: 'gratitude',
                title: 'Gratitude Journal',
                description: 'What are you grateful for today?',
                type: 'text'
            }
        ];

        // Initialize IndexedDB
        function initDB() {
            const request = indexedDB.open(DB_NAME, 2);

            request.onerror = () => {
                console.error('Database failed to open');
            };

            request.onsuccess = () => {
                db = request.result;
                loadTemplates();
            };

            request.onupgradeneeded = (e) => {
                db = e.target.result;
                
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                    objectStore.createIndex('title', 'title', { unique: false });
                }
            };
        }

        // Load templates
        function loadTemplates() {
            loadBuiltInTemplates();
            loadCustomTemplates();
        }

        // Load built-in templates
        function loadBuiltInTemplates() {
            const container = document.getElementById('builtInTemplates');
            
            container.innerHTML = BUILT_IN_TEMPLATES.map(template => {
                const type = template.type || 'dropdown';
                let optionsHTML = '';
                
                if (type === 'dropdown' && template.options) {
                    optionsHTML = template.options.map(option => `
                        <span class="option-tag" style="background-color: ${option.color}">
                            ${option.title}
                        </span>
                    `).join('');
                } else if (type === 'yesno') {
                    optionsHTML = '<span style="color: #666; font-size: 14px;">Yes / No</span>';
                } else if (type === 'numeric') {
                    const prefix = template.numericPrefix || '';
                    const suffix = template.numericSuffix || '';
                    optionsHTML = `<span style="color: #666; font-size: 14px;">Format: ${prefix}[number]${suffix}</span>`;
                } else if (type === 'text') {
                    optionsHTML = '<span style="color: #666; font-size: 14px;">Free text entry</span>';
                }
                
                return `
                    <div class="template-card built-in">
                        <div class="template-title">${template.title}</div>
                        <div class="template-description">${template.description}</div>
                        <div class="template-options">
                            ${optionsHTML}
                        </div>
                        <div class="template-actions">
                            <button class="btn btn-success btn-small" onclick='importTemplate(${JSON.stringify(template)})'>
                                Use Template
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Load custom templates from localStorage
        function loadCustomTemplates() {
            const container = document.getElementById('customTemplates');
            const customTemplates = JSON.parse(localStorage.getItem('customTemplates') || '[]');
            
            if (customTemplates.length === 0) {
                container.innerHTML = '<div class="empty-state">No custom templates yet. Create your first template!</div>';
                return;
            }

            container.innerHTML = customTemplates.map((template, index) => {
                const type = template.type || 'dropdown';
                let optionsHTML = '';
                
                if (type === 'dropdown' && template.options) {
                    optionsHTML = template.options.map(option => `
                        <span class="option-tag" style="background-color: ${option.color}">
                            ${option.title}
                        </span>
                    `).join('');
                } else if (type === 'yesno') {
                    optionsHTML = '<span style="color: #666; font-size: 14px;">Yes / No</span>';
                } else if (type === 'numeric') {
                    const prefix = template.numericPrefix || '';
                    const suffix = template.numericSuffix || '';
                    optionsHTML = `<span style="color: #666; font-size: 14px;">Format: ${prefix}[number]${suffix}</span>`;
                } else if (type === 'text') {
                    optionsHTML = '<span style="color: #666; font-size: 14px;">Free text entry</span>';
                }
                
                return `
                    <div class="template-card">
                        <div class="template-title">${template.title}</div>
                        <div class="template-description">${template.description || 'No description'}</div>
                        <div class="template-options">
                            ${optionsHTML}
                        </div>
                        <div class="template-actions">
                            <button class="btn btn-success btn-small" onclick='importTemplate(${JSON.stringify(template)})'>
                                Use Template
                            </button>
                            <button class="btn btn-primary btn-small" onclick='editCustomTemplate(${index})'>
                                Edit
                            </button>
                            <button class="btn btn-danger btn-small" onclick='deleteCustomTemplate(${index})'>
                                Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Import template as new tracker
        function importTemplate(template) {
            if (!db) {
                alert('Database not ready. Please try again.');
                return;
            }

            const type = template.type || 'dropdown';
            
            const tracker = {
                title: template.title,
                type: type,
                createdAt: new Date().toISOString()
            };

            // Add type-specific data
            if (type === 'dropdown' && template.options) {
                tracker.options = template.options;
            } else if (type === 'numeric') {
                tracker.numericPrefix = template.numericPrefix || '';
                tracker.numericSuffix = template.numericSuffix || '';
            }
            // yesno and text don't need additional data

            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const objectStore = transaction.objectStore(STORE_NAME);
            const request = objectStore.add(tracker);

            request.onsuccess = () => {
                alert(`"${template.title}" has been added to your trackers!`);
            };

            request.onerror = () => {
                alert('Failed to import template. Please try again.');
            };
        }

        // Open create template modal
        function openCreateTemplateModal() {
            currentTemplateId = null;
            document.getElementById('modalTitle').textContent = 'Create Template';
            document.getElementById('templateTitle').value = '';
            document.getElementById('templateDescription').value = '';
            document.getElementById('templateType').value = 'dropdown';
            document.getElementById('templateNumericPrefix').value = '';
            document.getElementById('templateNumericSuffix').value = '';
            document.getElementById('templateOptionsList').innerHTML = '';
            handleTemplateTypeChange();
            addTemplateOption(); // Add one default option
            document.getElementById('templateModal').classList.add('active');
        }

        // Handle template type change
        function handleTemplateTypeChange() {
            const type = document.getElementById('templateType').value;
            const dropdownSection = document.getElementById('templateDropdownOptions');
            const numericSection = document.getElementById('templateNumericSettings');

            // Hide all sections
            dropdownSection.classList.add('hidden');
            numericSection.classList.add('hidden');

            // Show relevant section
            if (type === 'dropdown') {
                dropdownSection.classList.remove('hidden');
            } else if (type === 'numeric') {
                numericSection.classList.remove('hidden');
            }
        }

        // Close template modal
        function closeTemplateModal() {
            document.getElementById('templateModal').classList.remove('active');
        }

        // Add option field
        function addTemplateOption(title = '', color = '#4CAF50') {
            const optionsList = document.getElementById('templateOptionsList');
            const optionId = Date.now() + Math.random();
            
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-item';
            optionDiv.id = `template-option-${optionId}`;
            optionDiv.innerHTML = `
                <input 
                    type="text" 
                    class="option-input option-title" 
                    placeholder="Option title" 
                    value="${title}"
                >
                <input 
                    type="color" 
                    class="color-picker option-color" 
                    value="${color}"
                >
                <button type="button" class="remove-option-btn" onclick="removeTemplateOption('${optionId}')">Ã—</button>
            `;
            
            optionsList.appendChild(optionDiv);
        }

        // Remove option field
        function removeTemplateOption(optionId) {
            const optionElement = document.getElementById(`template-option-${optionId}`);
            if (optionElement) {
                optionElement.remove();
            }
        }

        // Save template
        function saveTemplate(event) {
            event.preventDefault();
            
            const title = document.getElementById('templateTitle').value.trim();
            const description = document.getElementById('templateDescription').value.trim();
            const type = document.getElementById('templateType').value;

            if (!title) {
                alert('Please enter a template title');
                return;
            }

            const template = {
                title: title,
                description: description,
                type: type,
                createdAt: new Date().toISOString()
            };

            // Handle different tracker types
            if (type === 'dropdown') {
                const optionElements = document.querySelectorAll('#templateOptionsList .option-item');
                
                if (optionElements.length === 0) {
                    alert('Please add at least one option');
                    return;
                }

                const options = [];
                let hasEmptyTitle = false;
                
                optionElements.forEach(element => {
                    const titleValue = element.querySelector('.option-title').value.trim();
                    if (!titleValue) {
                        hasEmptyTitle = true;
                    }
                    options.push({
                        title: titleValue,
                        color: element.querySelector('.option-color').value
                    });
                });

                if (hasEmptyTitle) {
                    alert('Please fill in all option titles');
                    return;
                }

                template.options = options;
            } else if (type === 'numeric') {
                template.numericPrefix = document.getElementById('templateNumericPrefix').value.trim();
                template.numericSuffix = document.getElementById('templateNumericSuffix').value.trim();
            }
            // yesno and text don't need additional data

            let customTemplates = JSON.parse(localStorage.getItem('customTemplates') || '[]');
            
            if (currentTemplateId !== null) {
                // Update existing template
                customTemplates[currentTemplateId] = template;
            } else {
                // Add new template
                customTemplates.push(template);
            }

            localStorage.setItem('customTemplates', JSON.stringify(customTemplates));
            
            closeTemplateModal();
            loadCustomTemplates();
        }

        // Edit custom template
        function editCustomTemplate(index) {
            const customTemplates = JSON.parse(localStorage.getItem('customTemplates') || '[]');
            const template = customTemplates[index];
            
            currentTemplateId = index;
            document.getElementById('modalTitle').textContent = 'Edit Template';
            document.getElementById('templateTitle').value = template.title;
            document.getElementById('templateDescription').value = template.description || '';
            document.getElementById('templateType').value = template.type || 'dropdown';
            
            if (template.type === 'numeric') {
                document.getElementById('templateNumericPrefix').value = template.numericPrefix || '';
                document.getElementById('templateNumericSuffix').value = template.numericSuffix || '';
            }
            
            handleTemplateTypeChange();
            
            const optionsList = document.getElementById('templateOptionsList');
            optionsList.innerHTML = '';
            
            if ((template.type === 'dropdown' || !template.type) && template.options) {
                template.options.forEach(option => {
                    addTemplateOption(option.title, option.color);
                });
            }
            
            document.getElementById('templateModal').classList.add('active');
        }

        // Delete custom template
        function deleteCustomTemplate(index) {
            if (confirm('Are you sure you want to delete this template?')) {
                let customTemplates = JSON.parse(localStorage.getItem('customTemplates') || '[]');
                customTemplates.splice(index, 1);
                localStorage.setItem('customTemplates', JSON.stringify(customTemplates));
                loadCustomTemplates();
            }
        }

        // Close modal when clicking outside
        document.getElementById('templateModal').addEventListener('click', (e) => {
            if (e.target.id === 'templateModal') {
                closeTemplateModal();
            }
        });

        // Initialize app
        initDB();
    </script>
</body>
</html>